<!doctype html>
<html>

<head>
	<title>Today's Weather</title>
	<style>
		@import url(weather.css);
	</style>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<script>
			//get the user's country, city and time zone by calling api from ipwhois
			const ipURL=`https://ipwhois.app/json/`
			fetch(ipURL)
				.then( res => res.json())
				.then(response => {
				    //declaring al our variables
					var country,city,timezone;
					//we'll be using weather data from OpenWeather.org - but to use it we need to provide an API key (free for signing up)
					const weatherKey="ee4edea524d1e277c9414710809579a8"

				    country=response.country_code;
				    city=response.city;
				    timezone=response.timezone;
				    //console.log(country,city,timezone);
				    var inputVal=city + "," + country
				    const weatherurl = `https://api.openweathermap.org/data/2.5/weather?q=${inputVal}&appid=${weatherKey}&units=metric`;
				    //data is asynchronous meaning the only to access it is via a callback function
				    weatherDisplay(weatherurl);
				 })
				 .catch((data, status) => {
				    console.log('Request failed');
				});
			
			//callback function for getting data from API and using it to construct our display
			function weatherDisplay(url){
				fetch(url)
				.then(response => response.json())
				.then(data =>{
					//console.log(data);
					var d=new Date();
					var h = d.getHours();
					var m = d.getMinutes();
					var period;
					console.log(data);
					//**customized welcome message based on time of day**//
					if(h>4 && h<12){
						$("h1").text("Good Morning");
					}
					else if(h>11 && h<18){
						$("h1").text("Good Afternoon");
					}
					else{
						$("h1").text("Good Evening");
					    $("body").css({"background-color":"black"});
					}

					if (h==0){
						h=12;
						period="am";
					}
					else if (h<=11){
						period="am";
					}
					else if (h==12){
						period="pm";
					}
					else{
						period="pm";
						h=h%12;
					}

					//**temperature display here**//
					$("h2").text("The current temperature is "+ Math.round(data.main.temp));
					$("h2").append("&deg;C in " +data.name + ", " + data.sys.country); 

					//**weather display here**//
					var iconURL= "images/" + data.weather[0].icon + ".svg";
					// console.log(iconURL);
					var weatherCard = document.createElement("li");
					weatherCard.classList.add("weather");
					weatherCard.innerHTML = `<img class="weatherImage" src=${iconURL} alt=${data.weather[0].description}>`
					$("#iconlist").append(weatherCard);

					//add more cards depending on conditions
					if(data.wind.speed > 10)
					{
						iconURL="images/windy.svg";
						var weatherCard = document.createElement("li");
						weatherCard.classList.add("weather");
						weatherCard.innerHTML = `<img class="weatherImage" src=${iconURL} alt="Windy">`
						$("#iconlist").append(weatherCard);
					}

				})
				.catch(() => {
					
				});
			}
	</script>

</head>

<body>
<h1 id="greeting"></h1>
<h2 id="weather status"></h2>
<div id="weatherconditions">
	<ul id="iconlist">
	</ul>
</div>


</body>


</html>